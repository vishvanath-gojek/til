ASK : We need to build a OTP based login system flow

Requirements : 

1. OTP should be available for 1 mins
2. System should have low latency
3. Should be able to handle to allow last used OTP, which means if user should be able to login to recently generated OTPs
4. Should allow user to resent OTP via sms/email
5. Rate limit over how many OTP can be generated by user in a min.

Let's begin

We have a unique user-id for which we allow generation of OTPs.

Once, a request for OTP generation comes
check if user-id is legit or not
if true, generate a new OTP, and save it in zset in redis, with expiry time as 2 mins
send this OTP over via SMS
If user requests for resending of OTP
Fetch the latest OTP from set in redis and send via sms
If uses tries to enter OTP, check from the redis zset and allow user to login

save session token and log the attempt

Now, how do we restrict attempt on unsuccessful inputs

This will be another flow, where we save the  user attempt, thus enabling rate limiting